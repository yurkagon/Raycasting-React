(this["webpackJsonpraycasting-react"]=this["webpackJsonpraycasting-react"]||[]).push([[0],{137:function(t,e,i){},139:function(t,e,i){},140:function(t,e,i){},141:function(t,e,i){},142:function(t,e,i){},143:function(t,e,i){},144:function(t,e,i){"use strict";i.r(e);var n=i(1),a=i.n(n),s=i(45),o=i.n(s);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var r=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,145)).then((function(e){var i=e.getCLS,n=e.getFID,a=e.getFCP,s=e.getLCP,o=e.getTTFB;i(t),n(t),a(t),s(t),o(t)}))},c=i(4),u=i(47),h=i(2),l=i(3),f=i(48),d=i(7),g=i(21),v=i(20),y=function(){function t(){Object(h.a)(this,t),this.started=!1,b.getInstance().subscribe(this)}return Object(l.a)(t,[{key:"start",value:function(){this.started=!0}},{key:"isStarted",value:function(){return this.started}}]),t}(),p=function(){function t(){Object(h.a)(this,t),this.subscribers=[]}return Object(l.a)(t,[{key:"init",value:function(){var t=this;setInterval((function(){return t.update()}),10)}},{key:"update",value:function(){this.subscribers.forEach((function(t){t instanceof y?(t.isStarted()||t.start(),t.update()):t()}))}},{key:"subscribe",value:function(t){this.subscribers.push(t)}},{key:"unsubscribe",value:function(t){var e=this.subscribers.findIndex((function(e){return t===e}));this.subscribers.splice(e,1)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();p.instance=void 0;var b=p,j=i(11),O=i(46),m=i.n(O),x=function(){function t(){Object(h.a)(this,t),this.data=null,this.tileSize=32}return Object(l.a)(t,[{key:"setData",value:function(t){this.data=t}},{key:"handleCollision",value:function(t){var e,i,n=this.convertPositionToGridPosition(t),a=null===(e=this.data)||void 0===e||null===(i=e[Math.floor(n.y)])||void 0===i?void 0:i[Math.floor(n.x)];if(!(0!==a))return null;var s={x:n.x%1,y:n.y%1},o=s.y,r=s.x,c=[{side:"top",value:o},{side:"bottom",value:1-o},{side:"left",value:r},{side:"right",value:1-r}];return{point:t,gridPosition:n,floatPart:s,cell:a,collisionSide:m()(c,"value").side}}},{key:"convertPositionToGridPosition",value:function(t){return{x:t.x/this.tileSize,y:t.y/this.tileSize}}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();x.instance=void 0;var S=x,w=function(){function t(){Object(h.a)(this,t),this.MOUSE_SENSITIVITY=1.5,this.ROTATION_SPEED=2,this.moveState={toForward:!1,toBack:!1,rotateLeft:!1,rotateRight:!1},this.attachKeyDown(),this.attachKeyUp()}return Object(l.a)(t,[{key:"attachKeyDown",value:function(){var t=this;document.body.addEventListener("keydown",(function(e){var i=e.code;"KeyW"===i&&(t.moveState.toForward=!0),"KeyS"===i&&(t.moveState.toBack=!0),"KeyA"===i&&(t.moveState.rotateLeft=!0),"KeyD"===i&&(t.moveState.rotateRight=!0)}))}},{key:"attachKeyUp",value:function(){var t=this;document.body.addEventListener("keyup",(function(e){var i=e.code;"KeyW"===i&&(t.moveState.toForward=!1),"KeyS"===i&&(t.moveState.toBack=!1),"KeyA"===i&&(t.moveState.rotateLeft=!1),"KeyD"===i&&(t.moveState.rotateRight=!1)}))}}]),t}(),C=function(t){Object(g.a)(i,t);var e=Object(v.a)(i);function i(){var t;Object(h.a)(this,i);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).position={rotation:-1.884955592153879,x:372.6884332630978,y:128.58201781700896},t.walkSpeed=1,t.rotationSpeed=W.toRad(2),t.radius=8,t.control=new w,t}return Object(l.a)(i,[{key:"update",value:function(){var t=this.control.moveState,e=t.rotateLeft,i=t.rotateRight,n=t.toForward,a=t.toBack;if(e||i){var s=i?1:-1;this.position=Object(j.a)(Object(j.a)({},this.position),{},{rotation:this.position.rotation+this.rotationSpeed*s})}if(n||a){var o=n?1:-1,r={x:Math.cos(this.position.rotation)*this.walkSpeed*o,y:Math.sin(this.position.rotation)*this.walkSpeed*o};this.moveBy(r)}}},{key:"moveBy",value:function(t){var e=S.getInstance(),i=Object(j.a)(Object(j.a)({},this.position),{},{x:this.position.x+t.x,y:this.position.y+t.y});e.handleCollision(i)||(this.position=i)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new i),this.instance}}]),i}(y);C.instance=void 0;var M=C,R=function(){function t(e,i){Object(h.a)(this,t),this.point=void 0,this.angle=void 0,this.isRayFacingDown=void 0,this.isRayFacingUp=void 0,this.isRayFacingRight=void 0,this.isRayFacingLeft=void 0,this.collision=void 0,this.hitDistance=void 0,this.isVerticalCast=!1,this.isHorizontalCast=!1,this.stripHeight=0,this.maxDistance=300,this.grid=S.getInstance(),this.player=M.getInstance(),this.angle=W.normalize(i),this.point=e,this.isRayFacingDown=this.angle>0&&this.angle<Math.PI,this.isRayFacingUp=!this.isRayFacingDown,this.isRayFacingRight=this.angle<.5*Math.PI||this.angle>1.5*Math.PI,this.isRayFacingLeft=!this.isRayFacingRight}return Object(l.a)(t,[{key:"cast",value:function(){var t=this.castHorizontal(),e=this.castVertical();if(t||e){var i=t?_(this.player.position,t.point):Number.MAX_VALUE,n=e?_(this.player.position,e.point):Number.MAX_VALUE;i<n?(this.collision=t,this.hitDistance=i,this.isHorizontalCast=!0):n<=i&&(this.collision=e,this.hitDistance=n,this.isVerticalCast=!0);this.stripHeight=1e4/(Math.cos(M.getInstance().position.rotation-this.angle)*this.hitDistance)}}},{key:"castHorizontal",value:function(){var t,e,i,n;t=Math.floor(this.player.position.y/this.grid.tileSize)*this.grid.tileSize,t+=this.isRayFacingDown?this.grid.tileSize:0,e=this.player.position.x+(t-this.player.position.y)/Math.tan(this.angle),i=this.grid.tileSize,i*=this.isRayFacingUp?-1:1,n=this.grid.tileSize/Math.tan(this.angle),n*=this.isRayFacingLeft&&n>0?-1:1,n*=this.isRayFacingRight&&n<0?-1:1;for(var a=e,s=t;a>=0&&a<=2e3&&s>=0&&s<=2e3;){var o=this.grid.handleCollision({x:a,y:s-(this.isRayFacingUp?1:0)});if(o)return o;a+=n,s+=i}}},{key:"castVertical",value:function(){var t,e,i,n;e=Math.floor(this.player.position.x/this.grid.tileSize)*this.grid.tileSize,e+=this.isRayFacingRight?this.grid.tileSize:0,t=this.player.position.y+(e-this.player.position.x)*Math.tan(this.angle),n=this.grid.tileSize,n*=this.isRayFacingLeft?-1:1,i=this.grid.tileSize*Math.tan(this.angle),i*=this.isRayFacingUp&&i>0?-1:1,i*=this.isRayFacingDown&&i<0?-1:1;for(var a=e,s=t;a>=0&&a<=2e3&&s>=0&&s<=2e3;){var o=this.grid.handleCollision({x:a-(this.isRayFacingLeft?1:0),y:s});if(o)return o;a+=n,s+=i}}},{key:"castLegacy",value:function(){for(var t=0;t<this.maxDistance;){var e={x:Math.cos(this.angle)*t,y:Math.sin(this.angle)*t},i={x:this.point.x+e.x,y:this.point.y+e.y},n=this.grid.handleCollision(i);if(n){this.collision=n,this.hitDistance=_(this.point,i),this.stripHeight=1e4/(Math.cos(M.getInstance().position.rotation-this.angle)*this.hitDistance);break}t+=.5}}}]),t}(),k=[[2,2,2,2,1,1,1,1,1,1,1,1,2,2,2],[2,0,0,2,0,0,0,0,0,0,3,0,2,0,2],[2,0,0,0,0,3,0,0,0,0,0,0,2,0,2],[2,2,2,2,0,0,0,0,0,0,2,0,2,0,2],[1,0,0,0,0,0,0,0,0,0,2,0,2,0,2],[1,3,0,0,0,0,0,0,3,2,2,2,2,0,2],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,3,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,2,2,2,2,2,0,0,3,2,2,2,2,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],I=function(t){Object(g.a)(i,t);var e=Object(v.a)(i);function i(){var t;Object(h.a)(this,i);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).FOV=W.toRad(60),t.raysCount=160,t.player=M.getInstance(),t.grid=S.getInstance(),t.rays=[],t}return Object(l.a)(i,[{key:"start",value:function(){Object(f.a)(Object(d.a)(i.prototype),"start",this).call(this),this.grid.setData(k)}},{key:"update",value:function(){this.rays=[];for(var t=this.FOV/this.raysCount,e=this.player.position.rotation-this.FOV/2,i=0;i<this.raysCount;i++){var n=e+t*i,a=new R(this.player.position,n);a.cast(),this.rays.push(a)}}},{key:"setRaysCount",value:function(t){this.raysCount=t}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new i),this.instance}}]),i}(y);I.instance=void 0;var F=I,z=function(){var t=Object(n.useState)(null),e=Object(c.a)(t,2),i=e[0],a=e[1];return Object(n.useEffect)((function(){var t=b.getInstance(),e=F.getInstance(),i=function(){a(e.player.position)};return t.subscribe(i),function(){return t.unsubscribe(i)}}),[]),i},D=function(){var t=Object(n.useState)([]),e=Object(c.a)(t,2),i=e[0],a=e[1];return Object(n.useEffect)((function(){var t=b.getInstance(),e=F.getInstance(),i=function(){a(e.rays)};return t.subscribe(i),function(){return t.unsubscribe(i)}}),[]),i},H=(i(137),i(0)),E=function(){var t=D(),e=F.getInstance(),i=$(),n=i.width/e.raysCount;return Object(H.jsx)("div",{className:"div-render-strategy",children:t.map((function(t,e){if(!t.collision)return null;var a="top"===t.collision.collisionSide||"right"===t.collision.collisionSide?170:100,s=q(a*t.stripHeight/i.height,a),o="rgb(".concat(s,", ").concat(s,", ").concat(s,")");return Object(H.jsx)("div",{className:"strip",style:{width:n,height:t.stripHeight,left:n*e,top:(i.height-t.stripHeight)/2,backgroundColor:o}},e)}))})},P={1:i.p+"static/media/wall1.2598404c.jpg",2:i.p+"static/media/wall2.c183bd8a.jpg",3:i.p+"static/media/wall3.708ac57b.jpg"},N=(i(139),function(){var t=D(),e=F.getInstance();console.log(e.player.position);var i=$(),n=i.width/e.raysCount;return Object(H.jsx)("div",{className:"div-render-strategy-textured",children:t.map((function(t,e){if(!t.collision)return null;var a=("left"===t.collision.collisionSide||"right"===t.collision.collisionSide?t.collision.floatPart.y:t.collision.floatPart.x)*t.stripHeight;return Object(H.jsx)("div",{className:"strip",style:{width:n,height:t.stripHeight,left:n*e,top:(i.height-t.stripHeight)/2},children:Object(H.jsx)("div",{className:"texture",style:{backgroundImage:"url(".concat(P[t.collision.cell],")"),height:t.stripHeight,width:t.stripHeight,backgroundSize:"cover",backgroundPositionX:-a,opacity:2*t.stripHeight/i.height}})},e)}))})}),L=i(19),A=(i(140),function(){var t=D(),e=F.getInstance(),i=$();if(Object(n.useEffect)((function(){var t=e.raysCount;return e.setRaysCount(B.consoleRaysCount),function(){return e.setRaysCount(t)}}),[]),Object(n.useEffect)((function(){e.setRaysCount(Math.floor(i.width*B.viewportWidthToCharsScaleCoefficient))}),[i.width]),!t.length)return null;var a=Math.floor(i.height*B.viewportHeightToCharsScaleCoefficient),s=t.map((function(t){for(var e=Math.round(t.stripHeight/480*a),i=e>a?a:e,n=Array.from({length:i}).fill(X(i,a)),s=a-i,o=Math.ceil(s/2),r=s-o,c=0;c<o;c++)n.push(" ");for(var u=0;u<r;u++)n.unshift("_");return n})),o=Object(L.rotate)(s,270).map((function(t){return t.join("")})).join("\n");return Object(H.jsx)("div",{className:"text-render-strategy",children:Object(H.jsx)("textarea",{value:o,rows:a,readOnly:!0})})}),T=i.p+"static/media/devtools.39991061.jpeg",V=(i(141),function(){var t=Object(n.useState)(null),e=Object(c.a)(t,2),i=e[0],a=e[1],s=D(),o=F.getInstance(),r=$();Object(n.useEffect)((function(){var t=o.raysCount;return o.setRaysCount(B.consoleRaysCount),function(){return o.setRaysCount(t)}}),[]);var u=Math.floor(B.consoleHeight);return Object(n.useEffect)((function(){if(!s.length)return null;var t=s.map((function(t){for(var e=Math.round(t.stripHeight/480*u),i=e>u?u:e,n=Array.from({length:i}).fill(X(i,u)),a=u-i,s=Math.ceil(a/2),o=a-s,r=0;r<s;r++)n.push(" ");for(var c=0;c<o;c++)n.unshift("_");return n})),e=Object(L.rotate)(t,270).map((function(t){return t.join("")})).join("\n");a(e)}),[s]),Object(n.useEffect)((function(){i&&console.log(i)}),[i]),Object(n.useEffect)((function(){return function(){return console.clear()}}),[]),Object(H.jsx)("div",{className:"console-render-strategy",children:Object(H.jsxs)("div",{className:"description",children:[Object(H.jsx)("h3",{children:"Open browser console"}),Object(H.jsx)("img",{src:T,width:r.width})]})})}),K=function t(){Object(h.a)(this,t)};K.viewPortSizeMultiplier=.9,K.uiMapSizeMultiplier=.5,K.textRenderCharSpectre=",,:;I&&00%$@@#",K.viewportWidthToCharsScaleCoefficient=.33,K.viewportHeightToCharsScaleCoefficient=.166,K.consoleRaysCount=100,K.consoleHeight=40,K.renderingStrategies=[{name:"HTML <div> Textured",component:N,raysCountChangeAvailable:!0},{name:"HTML <div> Shaded",component:E,raysCountChangeAvailable:!0},{name:"HTML <textarea> (Only chrome)",component:A},{name:"Console in your Chrome (only) browser :D",component:V}];var B=K,U=function(){function t(){Object(h.a)(this,t)}return Object(l.a)(t,null,[{key:"normalize",value:function(t){return(t%=2*Math.PI)<0&&(t=2*Math.PI+t),t}}]),t}();U.toRad=function(t){return t*Math.PI/180},U.toDeg=function(t){return 180*t/Math.PI};var W=U,_=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},X=function(t,e){var i=",,:;I&&00%$@@#",n=Math.round(t/e*i.length);n<0&&(n=0),n>=i.length&&(n=i.length-1);return i[n]},$=function(){var t=Object(u.a)();return{width:Math.round(t.width*B.viewPortSizeMultiplier),height:Math.round(t.height*B.viewPortSizeMultiplier)}},q=function(t,e){return t>e?e:t},G=function(){var t=z();if(!t)return null;var e=F.getInstance(),i=2*e.player.radius;return Object(H.jsx)("div",{className:"player-marker",style:{top:t.y/2,left:t.x/2},children:Object(H.jsx)("div",{className:"marker-body",style:{height:i,width:i,top:-e.player.radius,left:-e.player.radius,transform:"rotate(".concat(t.rotation,"rad)")}})})},J=function(t){var e=t.from,i=t.to;i.x<e.x&&(e=t.to,i=t.from);var n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),a=Math.atan((i.y-e.y)/(i.x-e.x));return Object(H.jsx)("div",{style:{position:"absolute",transform:"translate(".concat(e.x-.5*n*(1-Math.cos(a)),"px, ").concat(e.y+.5*n*Math.sin(a),"px) rotate(").concat(a,"rad)"),width:"".concat(n,"px"),height:"".concat(0,"px"),borderBottom:"2px solid yellow"}})},Y=function(){var t=D(),e=z();return e?Object(H.jsx)(n.Fragment,{children:t.map((function(t,i){return t.collision?i%20!==0?null:Object(H.jsx)(J,{from:{x:e.x/2,y:e.y/2},to:{x:t.collision.point.x/2,y:t.collision.point.y/2}},i):null}))}):null},Q=(i(142),function(){var t=function(){var t=Object(n.useState)(null),e=Object(c.a)(t,2),i=e[0],a=e[1],s=Object(n.useState)(null),o=Object(c.a)(s,2),r=o[0],u=o[1];return Object(n.useEffect)((function(){var t=b.getInstance(),e=F.getInstance(),i=function(){a(e.grid.data),u(e.grid.tileSize)};return t.subscribe(i),function(){return t.unsubscribe(i)}}),[]),i?{data:i,tileSize:r}:null}();if(!t)return null;var e=t.tileSize/2,i=t.data.length,a=t.data[0].length*e,s=i*e;return Object(H.jsx)("div",{className:"ui-map",children:Object(H.jsxs)("div",{className:"cell-wrapper",style:{width:a,height:s},children:[Object(H.jsx)(Y,{}),t.data.map((function(t,i){return Object(H.jsxs)(n.Fragment,{children:[t.map((function(t,n){return 0===t?null:Object(H.jsx)("div",{className:"cell",style:{top:i*e,left:n*e,width:e,height:e}},n)})),Object(H.jsx)(G,{})]},i)}))]})})}),Z=function(){var t=F.getInstance(),e=Object(n.useState)(t.FOV),i=Object(c.a)(e,2),a=i[0],s=i[1],o=Object(n.useState)(t.raysCount),r=Object(c.a)(o,2),u=r[0],h=r[1],l=Object(n.useState)(B.renderingStrategies[1]),f=Object(c.a)(l,2),d=f[0],g=f[1];Object(n.useEffect)((function(){b.getInstance().init()}),[]),Object(n.useEffect)((function(){t.FOV=a}),[a]),Object(n.useEffect)((function(){t.raysCount=u}),[u]),Object(n.useEffect)((function(){h(t.raysCount)}),[d,t]);var v=$(),y=v.height,p=v.width;return Object(H.jsxs)("div",{className:"App",children:[Object(H.jsxs)("div",{className:"game-view-port",style:{width:p,height:y},children:[Object(H.jsx)(d.component,{}),Object(H.jsx)(Q,{})]}),Object(H.jsxs)("div",{children:[Object(H.jsxs)("div",{children:["Rendering strategy:"," ",Object(H.jsx)("select",{onChange:function(t){var e=B.renderingStrategies.find((function(e){return e.name===t.target.value}));g(e)},value:d.name,autoFocus:!1,children:B.renderingStrategies.map((function(t){return Object(H.jsx)("option",{value:t.name,children:t.name},t.name)}))})]}),Object(H.jsxs)("div",{children:["FOV:","  ",Object(H.jsx)("input",{type:"range",min:"20",max:"360",value:W.toDeg(a),step:"10",onChange:function(t){return s(W.toRad(Number(t.target.value)))}}),"Value: ",Math.round(W.toDeg(a)),"\xb0 (default: 60\xb0)"]}),d.raysCountChangeAvailable&&Object(H.jsxs)("div",{children:["RAYS:",Object(H.jsx)("input",{type:"range",min:"10",max:"500",value:u,step:"10",onChange:function(t){return h(Number(t.target.value))}}),"Value: ",u," (default: 160)"]})]})]})};i(143);o.a.render(Object(H.jsx)(a.a.StrictMode,{children:Object(H.jsx)(Z,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)})),r()}},[[144,1,2]]]);
//# sourceMappingURL=main.4992b5b9.chunk.js.map